
{% extends 'unemp_nav.html' %}
{% block content %}

<style>

   body {
       font-family: Arial, sans-serif;
       background-color: #f4f4f4;
       margin: 0;
       padding: 0;
       display: flex;
       flex-direction: column;
       min-height: 100vh;
   }

   .sidebar.collapsed {
       transform: translateX(-100%);
   }
   .sidebar h1 {
       margin: 0;
       padding: 0 20px;
       text-align: center;
   }
   .sidebar .home-button {
       background-color: #17a2b8;
       color: white;
       padding: 10px 20px;
       border: none;
       border-radius: 4px;
       text-decoration: none;
       font-size: 16px;
       margin-top: 20px;
       display: inline-block;
   }
   .sidebar .home-button:hover {
       background-color: #138496;
   }
   .toggle-button {
       position: fixed;
       top: 20px;
       left: 220px;
       background-color: #17a2b8;
       color: white;
       border: none;
       padding: 10px;
       border-radius: 4px;
       cursor: pointer;
       z-index: 1001;
   }
   .toggle-button.collapsed {
       left: 20px;
   }
   main {
       display: flex;
       flex-direction: column;
       align-items: center;
       justify-content: center;
       flex: 1;
       padding-top: 20px;
       padding-bottom: 100px; /* Space for the footer */
       transition: margin-left 0.3s ease;
   }
   main.collapsed {
       margin-left: 0;
   }
   #chat-container {
       display: flex;
       flex-direction: column;
    max-width: 600px;
       width: 100%;
       background: white;
       border-radius: 8px;
       box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
       overflow: hidden;
       flex: 1;
       
   }
   #chat-box {
       flex: 1;
       
       padding: 1em;
       
       overflow-y: auto;
       border-bottom: 1px solid #ddd;
   }
   .message {
       margin: 0.5em 0;
       padding: 0.5em;
       border-radius: 4px;
       background-color: #e1ffc7;
       max-width: 80%;
       word-wrap: break-word;
   }
   .message .username {
       font-weight: bold;
       margin-right: 5px;
   }
   .message.user-message {
       align-self: flex-end;
       background-color: #dcf8c6;
   }
   .message.bot-message {
       align-self: flex-start;
       background-color: #f1f1f1;
   }
   #user-input {
       display: flex;
       padding: 1em;
       border-top: 1px solid #ddd;
   }
   #user-input input {
       flex: 1;
       padding: 0.5em;
       border: 1px solid #ddd;
       border-radius: 4px;
   }
   #user-input button {
       padding: 0.5em 1em;
       margin-left: 1em;
       border: none;
       background-color: #4CAF50;
       color: white;
       border-radius: 4px;
       cursor: pointer;
   }
   #user-input button:hover {
       background-color: #45a049;
   }
   .encryption-notice {
       text-align: center;
       font-size: 14px;
       color: #888;
       margin-bottom: 10px;
   }
   .username {
       cursor: pointer;
       color: #007bff;
   }
   .username:hover {
       text-decoration: underline;
   }
   .username-clicked {
       animation: highlight 0.5s ease;
   }
   @keyframes highlight {
       from {
           background-color: yellow;
       }
       to {
           background-color: transparent;
       }
   }
   .footer {
       background-color: #000000;
       color: white;
       width: 100%;
       position: relative;
       display: flex;
       flex-direction: column;
       bottom: 0;
       left: 0;
       padding: 20px 0;
       margin-top: auto;
   }
   .footer .col-lg-3, .footer .col-md-6 {
       flex: 1;
       padding: 10px;
       text-align: center;
   }
   .footer h5 {
       margin-bottom: 15px;
   }
   .footer .btn-link {
       color: #bbb;
       text-decoration: none;
   }
   .footer .btn-link:hover {
       color: white;
   }
   @media (max-width: 768px) {
       .sidebar {
           width: 200px;
           height: 100%;
           position: fixed;
           top: 0;
           left: 0;
           transform: translateX(-100%);
       }
       .sidebar.collapsed {
           transform: translateX(0);
       }
       .toggle-button {
           top: 20px;
           left: 20px;
       }
       .toggle-button.collapsed {
           left: 220px;
       }
       main {
           margin-left: 0;
           padding-top: 20px;
       }
       main.collapsed {
           padding-top: 20px;
       }
   }
   .dropdown-menu {
     min-width: 200px; /* Ensure a consistent dropdown width */
   }
   
   @media (max-width: 768px) {
     .dropdown-menu {
       width: 100%; /* Full-width dropdown on smaller screens */
       left: 0 !important; /* Align to the screen's left edge */
       right: 0 !important;
        padding-left: 40px; /* Align to the screen's right edge */
     }
   }
   .dropdown-menu {
     width: 100%; /* Full-width dropdown on smaller screens */
     left: 0 !important; /* Align to the screen's left edge */
     right: 0 !important;
    }
   /* General Chat Container Styling */
#chat-container {
display: flex;
flex-direction: column;
justify-content: space-between;
max-width: 600px;
margin: 0 auto;
height: 80vh; /* Adjust height as needed */
border: 1px solid #ccc;
border-radius: 10px;
padding: 10px;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* Encryption Notice */
.encryption-notice {
font-size: 14px;
color: #777;
margin-bottom: 10px;
}

/* Chat Box */
#chat-box {
flex-grow: 1;
overflow-y: auto;
margin-bottom: 10px;
padding: 10px;
border: 1px solid #ccc;
border-radius: 5px;
background-color: #f9f9f9;
}

/* User Input Area */
#user-input {
display: flex;
gap: 10px;
}

#message {
flex: 1;
padding: 10px;
font-size: 16px;
border: 1px solid #ccc;
border-radius: 5px;
}

#send-btn {
padding: 10px 20px;
font-size: 16px;
border: none;
border-radius: 5px;
background-color: #007bff;
color: white;
cursor: pointer;
transition: background-color 0.3s;
}

#send-btn:hover {
background-color: #0056b3;
}

/* Responsive Design */
@media (max-width: 768px) {
#chat-container {
width: 90%; /* Adjust width for smaller screens */
height: auto; /* Allow height to adapt */
}

#chat-box {
max-height: 50vh; /* Limit chat box height */
}

#user-input {
flex-direction: column;
gap: 5px; /* Reduce gap for smaller screens */
}

#message {
width: 100%; /* Input spans full width */
}

#send-btn {
width: 100%; /* Button spans full width */
}
}
body {
margin: 0;
display: flex;
flex-direction: column;
min-height: 100vh;
}

/* Navbar Styling */
.navbar {
position: fixed;
top: 0;
left: 0;
width: 100%;
z-index: 1030;
background-color: white;
box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
border-bottom: 1px solid #ddd;
}

.navbar .btn {
margin-left: auto;
}

/* Sidebar Styling */
.vertical-nav {
background-color: white;
color: #0e0d0d;
width: 250px;
height: calc(100vh - 56px);
position: fixed;
top: 56px;
left: 0;
z-index: 1020;
overflow-y: auto;
transition: all 0.3s ease; /* Smooth transition for toggle */
}

.vertical-nav.collapsed {
left: -250px; /* Move sidebar off-screen */
width: 250px; /* Keep width to avoid overflow hidden issues */
}


.vertical-nav .nav-link {
color: #0e0d0d;
font-weight: normal;
margin: 10px 0;
}

.vertical-nav .nav-link:hover {
background-color: #495057;
border-radius: 5px;
}

/* Main Content Styling */
.main-content {
margin-left: 250px;
margin-top: 56px;
padding: 20px;
background-color: #e3e9eb;
flex-grow: 1;
transition: margin-left 0.3s ease; /* Match transition timing */
}


.main-content.collapsed {
margin-left: 0;
}

/* Footer Styling */
.footer {
background-color: white;
text-align: center;
padding: 15px 0;
flex-direction: column;
display: flex;
margin-top: 40px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
.vertical-nav {
    left: -250px;
    transition: left 0.3s ease-in-out;
}
.vertical-nav.collapsed {
    left: 0;
}
.main-content {
    margin-left: 0;
}
}

@media (min-width: 769px) and (max-width: 1178px) {
.vertical-nav {
    left: 0;
    transition: width 0.3s ease-in-out;
}
.vertical-nav.collapsed {
    width: 0;
    overflow: hidden;
}
.main-content {
    margin-left: 250px;
}
.main-content.collapsed {
    margin-left: 0;
}
}

@media (min-width: 1179px) {
.vertical-nav {
    left: 0;
    width: 250px;
}
.main-content {
    margin-left: 250px;
}
}
@media (min-width: 992px) {  
#crm{
    margin-top: 10px;
}
}
.dropdown {
    position: relative;
  }
  
  .dropdown-content {
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    padding: 12px 16px;
    z-index: 1;
  }
  
  
</style>
<!--
<nav class="navbar navbar-dark">
<div class="container-fluid d-flex align-items-center">
    <label id="crm" for=""><strong> <i class="fa fa-briefcase"></i> Job Market</strong></label>
    <button id="sidebarToggle" class="btn btn-outline-primary ml-3">
        <i class="fas fa-bars"></i>
    </button>
    
    <a href="{% url 'home' %}" class="ml-auto">
        <button class="btn btn-primary">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </a>
   
</div>

</nav>

 
    <div id="sidebar" class="vertical-nav"> 
        <div class="dropdown">
            <a href="#" 
               class="navbar-brand mb-0 h1 ml-5 text-dark dropdown-toggle" 
               id="adminDropdown" 
               role="button" 
               data-toggle="dropdown" 
               aria-haspopup="true" 
               aria-expanded="false">
                User
            </a>
            <div class="dropdown-menu" aria-labelledby="adminDropdown">
                <a class="dropdown-item" href="/account-settings/">Account Settings</a>
                <a class="dropdown-item" href="{% url 'home' %}">Logout</a>
            </div>
        </div>
   
 
<a class="nav-link" href="{% url 'admindash' %}"><i class="fas fa-th-large"></i> Dashboard</a>
<a class="nav-link" href="{% url 'enter_unemp' %}"><i class="fas fa-user-alt"></i> Chat</a>

<div class="dropdown">
    <span>Services</span>
    <div class="dropdown-content">
      <p>option 1</p>
      <p>Option 2</p>
    </div>
  </div>
    
 
</div>

-->

  
<main>
<br><br>
<div id="chat-container">
<div class="encryption-notice text-center">Your conversation is end-to-end encrypted</div>
<div id="chat-box">
 Chat messages will appear here
</div>
<div id="user-input" class="input-group">
 <input type="text" id="message" class="form-control" placeholder="Type your message...">
 <button id="send-btn" class="btn btn-primary">Send</button>
</div>
</div>
</main>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
 

<script>
    $(document).ready(function () {
      // Initialize dropdowns
      $('.dropdown-toggle').dropdown();
    });
  </script>
  
<!--<script>
    
$(document).ready(function () {
    // Toggle sidebar on button click
    $('#sidebarToggle').on('click', function (e) {
        e.stopPropagation(); // Prevent click from propagating to document
        $('#sidebar').toggleClass('collapsed');
        $('.main-content').toggleClass('collapsed');
    });

    // Prevent clicks inside the sidebar from closing it
    $('#sidebar').on('click', function (e) {
        e.stopPropagation(); // Stops the click event from bubbling up
    });

    // Close sidebar when clicking anywhere else on small screens
    $(document).on('click', function () {
        const width = $(window).width();
        if (width <= 768) {
            $('#sidebar').addClass('collapsed');
            $('.main-content').addClass('collapsed');
        }
    });

    // Prevent main content clicks from affecting sidebar toggle
    $('.main-content').on('click', function (e) {
        e.stopPropagation(); // Prevents unintentional sidebar collapse
    });

    // Handle initial collapse based on screen width
    function handleResize() {
        const width = $(window).width();
        if (width <= 768) {
            $('#sidebar').addClass('collapsed');
            $('.main-content').addClass('collapsed');
        } else {
            $('#sidebar').removeClass('collapsed');
            $('.main-content').removeClass('collapsed');
        }
    }

    // Run on load and on window resize
    handleResize();
    $(window).resize(handleResize);
});

</script>-->
<script>
   const username = "{{ username }}";
   const room = "{{ room }}";

   function getMessageColor(length) {
       if (length < 20) {
           return '#e1ffc7'; // Light green for short messages
       } else if (length < 50) {
           return '#dcf8c6'; // Slightly darker green for medium messages
       } else {
           return '#c8e6c9'; // Darker green for long messages
       }
   }

   function fetchMessages() {
       $.get(`/get_messages/${room}/`, function(data) {
           const chatBox = $('#chat-box');
           chatBox.empty();
           data.messages.forEach(function(msg) {
               const messageElement = $('<div>').addClass('message').html(`<span class="username" data-username="${msg.username}">${msg.username}</span>: ${msg.content}`);
               messageElement.css('background-color', getMessageColor(msg.content.length));
               chatBox.append(messageElement);
           });
           chatBox.scrollTop(chatBox[0].scrollHeight);
       });
   }

   $(document).ready(function() {
       fetchMessages();
       setInterval(fetchMessages, 1000);

       $('#send-btn').click(function() {
           const message = $('#message').val();
           if (message.trim() !== '') {
               console.log('Sending message:', message);
               $.post('/send_message/', {
                   username: username,
                   room: room,
                   content: message,
                   csrfmiddlewaretoken: '{{ csrf_token }}'
               }, function(data) {
                   console.log('Message sent:', data);
                   $('#message').val('');
                   fetchMessages();
               }).fail(function(xhr, status, error) {
                   console.error('Error sending message:', error);
               });
           }
       });

       $(document).on('click', '.username', function() {
           const targetUsername = $(this).data('username');
           if (targetUsername !== username) {
               $(this).addClass('username-clicked');
               const privateRoom = [username, targetUsername].sort().join('_');
               setTimeout(() => {
                   window.location.href = `/chat_unemp/?username=${username}&room=${privateRoom}`;
               }, 500); // Delay to allow the animation to play
           }
       });

       $('.toggle-button').click(function() {
           $('.sidebar').toggleClass('collapsed');
           $('main').toggleClass('collapsed');
           $(this).toggleClass('collapsed');
       });
   });
</script>


</div></body></html>
{% endblock %}